# 明道云接口调用项目规则

## 1. 数据交互规范

### 1.1 接口调用要求
- 所有数据交互必须通过明道云API接口实现
- 必须严格遵循明道云API规范进行数据调取和操作
- 接口调用必须使用组件封装的方法，不得直接调用明道云原生接口

### 1.2 组件使用规范
项目中提供了以下四个明道云API调用组件，必须通过这些组件进行接口调用：
- `MingDaoYunAPI`：单条数据查询（getRowByIdPost接口）
- `MingDaoYunAddAPI`：新增数据（addRow接口）
- `MingDaoYunUpdateAPI`：更新数据（editRow接口）
- `MingDaoYunArrayAPI`：批量查询数据（getFilterRows接口）

### 1.3 组件调用方式
所有组件均已暴露到全局window对象，可通过以下方式调用：
```javascript
const api = new window.MingDaoYunArrayAPI();
const result = await api.getData(params);
```

## 2. Filters参数格式规范

### 2.1 强制要求
- **filters参数必须严格使用数组格式**，不得使用其他数据结构
- 数组中的每个元素必须是包含指定字段的对象

### 2.2 标准结构
```javascript
[
  {
    "controlId": "字段ID",
    "dataType": 数据类型,
    "spliceType": 拼接类型,
    "filterType": 过滤类型,
    "value": 过滤值
  }
]
```

### 2.3 字段说明
| 字段名 | 类型 | 说明 | 必填 |
|-------|------|------|------|
| controlId | String | 明道云中字段的唯一标识 | 是 |
| dataType | Number | 数据类型（如2表示文本类型） | 是 |
| spliceType | Number | 拼接类型（1表示AND，2表示OR） | 是 |
| filterType | Number | 过滤类型（如2表示等于，24表示包含） | 是 |
| value | Any | 过滤值 | 是 |

### 2.4 示例
```javascript
[
  {
    "controlId": "openid",
    "dataType": 2,
    "spliceType": 1,
    "filterType": 24,
    "value": "openid"
  },
  {
    "controlId": "del",
    "dataType": 2,
    "spliceType": 1,
    "filterType": 2,
    "value": 0
  }
]
```

## 3. 删除功能规范

### 3.1 物理删除
- **物理删除必须在明道云平台直接进行**
- 前端系统严禁执行任何物理删除操作

### 3.2 逻辑删除
- 前端系统仅允许执行逻辑删除操作
- 逻辑删除通过操作"del"字段实现
- 删除时将"del"字段值设置为1

### 3.3 过滤要求
- 所有数据查询接口调用时必须包含del字段过滤条件
- 默认过滤条件：`{"controlId": "del", "dataType": 2, "spliceType": 1, "filterType": 2, "value": 0}`

## 4. 组件修改限制

### 4.1 修改原则
- 仅在组件的基本通用调用功能出现问题时方可进行修改
- 无明确功能问题时，保持现有组件代码不变

### 4.2 允许修改的情况
- 接口调用失败且确定是组件代码问题
- 明道云API规范变更导致现有组件不兼容
- 组件存在明显的性能问题或安全漏洞

### 4.3 修改流程
1. 记录问题并分析原因
2. 提出修改方案并进行评估
3. 进行修改并测试
4. 更新相关文档

## 5. 错误处理规范

### 5.1 组件返回格式
所有组件均返回统一格式的结果：
```javascript
{
  "success": Boolean,  // 是否成功
  "data": Object,     // 返回数据
  "error_msg": String,// 错误信息
  "error_code": Number// 错误代码
}
```

### 5.2 错误处理要求
- 必须对组件返回的结果进行错误判断
- 错误信息必须友好展示给用户
- 重要错误必须记录日志

## 6. 性能与安全规范

### 6.1 超时设置
组件已内置5秒超时机制，无需额外设置

### 6.2 重试机制
组件已内置网络错误自动重试1次的机制

### 6.3 数据安全
- 不得在前端代码中暴露敏感信息
- 接口调用必须使用组件内置的安全配置

## 7. 版本控制

- 组件版本变更必须记录在案
- 版本变更必须确保向后兼容
- 重大变更必须通知所有相关开发人员

## 8. UI开发规范

### 8.1 弹窗层级管理
- **DOM 位置**：所有全屏弹窗（Modal）的 DOM 节点建议放置在 `<body>` 标签的直接子级最末尾，确保在 DOM 顺序上位于普通页面内容之后。
- **层叠上下文（Stacking Context）**：
  - 若遇到 `z-index` 设置极大但仍然被遮挡的情况，通常是因为父级元素建立了层叠上下文。
  - **解决方案**：
    1. 将受影响的弹窗 DOM 节点移至 `<body>` 的最末尾（确保在所有其他弹窗节点之后）。
    2. 给该弹窗添加 CSS 属性 `transform: translateZ(0);` 或 `will-change: transform;` 以强制建立独立的根层叠上下文，脱离原有层级限制。

### 8.2 多层弹窗处理
- 当存在多层弹窗叠加场景（如：在“详情弹窗”中点击打开“编辑弹窗”），必须保证“编辑弹窗”的 DOM 节点在 HTML 结构中位于“详情弹窗”之后，否则即使 `z-index` 更高也可能被覆盖。

---

**生效日期**：2025-12-29
**修订版本**：1.1
